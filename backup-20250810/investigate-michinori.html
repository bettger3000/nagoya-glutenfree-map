<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¿ã¡ã®ã‚Šäº­åº§æ¨™èª¿æŸ»</title>
    <style>
        body { 
            font-family: 'Noto Sans JP', sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #F8C8DC, #E8B4FF);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #2D2D2D; 
            text-align: center;
            margin-bottom: 30px;
        }
        button {
            background: #F8C8DC;
            color: #2D2D2D;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #E8B4FF;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ã¿ã¡ã®ã‚Šäº­åº§æ¨™èª¿æŸ»</h1>
        
        <div style="text-align: center;">
            <button onclick="investigateStore()">ğŸ•µï¸ ã¿ã¡ã®ã‚Šäº­ã®åº§æ¨™ã‚’èª¿æŸ»</button>
            <button onclick="updateMichinoriDirectly()">ğŸ“ ã¿ã¡ã®ã‚Šäº­åº§æ¨™ã‚’ç›´æ¥æ›´æ–°</button>
            <button onclick="checkAllStores()">ğŸ“Š å…¨åº—èˆ—åº§æ¨™ã‚’ç¢ºèª</button>
        </div>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script>
        const SUPABASE_URL = 'https://lywfaolwvkewuouvkzlk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5d2Zhb2x3dmtld3VvdXZremxrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MDg2NjcsImV4cCI6MjA2OTk4NDY2N30.wBGCHOLbP6ew7Bnvxrq0sKSm1EnHk5NNE1sWWH7ff60';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function showResult(content, type = 'normal') {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = content;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
        }

        async function investigateStore() {
            try {
                showResult('èª¿æŸ»ä¸­...', 'normal');
                
                const { data, error } = await supabase
                    .from('stores')
                    .select('*')
                    .ilike('name', '%ã¿ã¡ã®ã‚Šäº­%');
                    
                if (error) throw error;
                
                if (data && data.length > 0) {
                    const store = data[0];
                    let result = `ã¿ã¡ã®ã‚Šäº­ èª¿æŸ»çµæœ:\n\n`;
                    result += `åº—èˆ—å: ${store.name}\n`;
                    result += `ID: ${store.id}\n`;
                    result += `ç·¯åº¦: ${store.latitude} (å‹: ${typeof store.latitude})\n`;
                    result += `çµŒåº¦: ${store.longitude} (å‹: ${typeof store.longitude})\n`;
                    result += `ä½æ‰€: ${store.address}\n`;
                    result += `ã‚«ãƒ†ã‚´ãƒª: ${store.category}\n`;
                    result += `ä½œæˆæ—¥: ${store.created_at}\n`;
                    result += `æ›´æ–°æ—¥: ${store.updated_at}\n`;
                    
                    // æœŸå¾…ã•ã‚Œã‚‹åº§æ¨™ã¨æ¯”è¼ƒ
                    result += `\næœŸå¾…ã•ã‚Œã‚‹åº§æ¨™ (stores.jsonã‚ˆã‚Š):\n`;
                    result += `ç·¯åº¦: 35.1695\n`;
                    result += `çµŒåº¦: 136.879\n`;
                    
                    const isCorrect = (store.latitude == 35.1695 && store.longitude == 136.879);
                    result += `\nåº§æ¨™ã¯æ­£ç¢ºã‹: ${isCorrect ? 'âœ… ã¯ã„' : 'âŒ ã„ã„ãˆ'}`;
                    
                    showResult(result, isCorrect ? 'success' : 'error');
                } else {
                    showResult('ã¿ã¡ã®ã‚Šäº­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
                }
            } catch (error) {
                showResult(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        async function updateMichinoriDirectly() {
            try {
                showResult('ã¿ã¡ã®ã‚Šäº­ã®åº§æ¨™ã‚’æ›´æ–°ä¸­...', 'normal');
                
                // ã¾ãšåº—èˆ—ã‚’æ¤œç´¢
                const { data: stores, error: searchError } = await supabase
                    .from('stores')
                    .select('*')
                    .ilike('name', '%ã¿ã¡ã®ã‚Šäº­%');
                    
                if (searchError) throw searchError;
                
                if (stores && stores.length > 0) {
                    const store = stores[0];
                    
                    // åº§æ¨™ã‚’æ›´æ–°
                    const { data, error } = await supabase
                        .from('stores')
                        .update({
                            latitude: 35.1695,
                            longitude: 136.879
                        })
                        .eq('id', store.id)
                        .select();
                        
                    if (error) throw error;
                    
                    let result = `âœ… ã¿ã¡ã®ã‚Šäº­ã®åº§æ¨™ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼\n\n`;
                    if (data && data.length > 0) {
                        const updated = data[0];
                        result += `æ›´æ–°å¾Œã®åº§æ¨™:\n`;
                        result += `ç·¯åº¦: ${updated.latitude}\n`;
                        result += `çµŒåº¦: ${updated.longitude}\n`;
                        result += `æ›´æ–°æ—¥æ™‚: ${updated.updated_at}`;
                    }
                    
                    showResult(result, 'success');
                } else {
                    showResult('ã¿ã¡ã®ã‚Šäº­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
                }
            } catch (error) {
                showResult(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        async function checkAllStores() {
            try {
                showResult('å…¨åº—èˆ—ã®åº§æ¨™ã‚’ç¢ºèªä¸­...', 'normal');
                
                const { data, error } = await supabase
                    .from('stores')
                    .select('id, name, latitude, longitude')
                    .order('name');
                    
                if (error) throw error;
                
                let result = `å…¨åº—èˆ—åº§æ¨™ç¢ºèªçµæœ:\n\n`;
                let validCount = 0;
                let invalidCount = 0;
                
                data.forEach(store => {
                    const hasValidCoords = (
                        store.latitude && 
                        store.longitude && 
                        store.latitude !== 'undefined' && 
                        store.longitude !== 'undefined' &&
                        !isNaN(parseFloat(store.latitude)) &&
                        !isNaN(parseFloat(store.longitude))
                    );
                    
                    if (hasValidCoords) {
                        validCount++;
                    } else {
                        invalidCount++;
                        result += `âŒ ${store.name}: lat=${store.latitude}, lng=${store.longitude}\n`;
                    }
                });
                
                result = `ğŸ“Š çµ±è¨ˆ:\næœ‰åŠ¹ãªåº§æ¨™: ${validCount}ä»¶\nç„¡åŠ¹ãªåº§æ¨™: ${invalidCount}ä»¶\n\n` + result;
                
                showResult(result, invalidCount === 0 ? 'success' : 'error');
            } catch (error) {
                showResult(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>