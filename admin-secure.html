<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚»ã‚­ãƒ¥ã‚¢ç®¡ç†ç”»é¢ - ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ãƒãƒƒãƒ—</title>
    
    <!-- Google tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CL6YY713PG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CL6YY713PG');
    </script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-pink: #ffb6c1;
            --primary-green: #98d8c8;
            --success-green: #28a745;
            --danger-red: #dc3545;
            --warning-orange: #ffc107;
            --info-blue: #17a2b8;
            --dark-gray: #4a4a4a;
            --light-gray: #f8f9fa;
            --border-color: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Meiryo', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, var(--primary-pink) 0%, var(--primary-green) 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: var(--dark-gray);
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--light-gray);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .user-info .welcome {
            color: var(--dark-gray);
            font-weight: bold;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--primary-pink) 0%, var(--primary-green) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-weight: 500;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn.btn-success {
            background: var(--success-green);
        }
        
        .btn.btn-danger {
            background: var(--danger-red);
        }
        
        .btn.btn-warning {
            background: var(--warning-orange);
            color: var(--dark-gray);
        }
        
        .btn.btn-info {
            background: var(--info-blue);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .controls {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .controls h2 {
            color: var(--dark-gray);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .table-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background: linear-gradient(135deg, var(--primary-pink) 0%, var(--primary-green) 100%);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:hover {
            background-color: var(--light-gray);
        }
        
        .category-badge {
            padding: 6px 12px;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .category-å’Œé£Ÿ { background-color: #ff6b6b; }
        .category-æ´‹é£Ÿ { background-color: #4ecdc4; }
        .category-ã‚«ãƒ•ã‚§ { background-color: #f7b731; }
        .category-ãƒ‘ãƒ³å±‹ { background-color: #5f27cd; }
        .category-è²©å£²åº— { background-color: #00d2d3; }
        .category-ã‚¹ã‚¤ãƒ¼ãƒ„ { background-color: #ff69b4; }
        
        .visit-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .visit-status.naco {
            background-color: #ffe6e6;
            color: #d32f2f;
        }
        
        .visit-status.member {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .visit-status.unvisited {
            background-color: #f5f5f5;
            color: #666;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            max-height: 90vh;
            margin: 50px auto;
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .modal-header h2 {
            color: var(--dark-gray);
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: var(--light-gray);
            color: var(--dark-gray);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-gray);
            font-weight: bold;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(152, 216, 200, 0.1);
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            line-height: 1.4;
        }
        
        .status {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .csv-drop-zone {
            border: 3px dashed var(--primary-green);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s;
            cursor: pointer;
            background: var(--light-gray);
        }
        
        .csv-drop-zone:hover,
        .csv-drop-zone.dragover {
            border-color: var(--primary-pink);
            background: #fff;
            transform: translateY(-2px);
        }
        
        .csv-drop-zone i {
            font-size: 48px;
            color: var(--primary-green);
            margin-bottom: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary-green);
            margin-bottom: 5px;
        }
        
        .stat-card .label {
            color: var(--dark-gray);
            font-size: 14px;
        }
        
        .login-container {
            max-width: 500px;
            margin: 100px auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .login-container h1 {
            color: var(--dark-gray);
            margin-bottom: 30px;
        }
        
        .login-form .form-group {
            text-align: left;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .controls, .table-container {
                padding: 20px;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginContainer" class="login-container">
        <h1><i class="fas fa-shield-alt"></i> ã‚»ã‚­ãƒ¥ã‚¢ç®¡ç†ç”»é¢</h1>
        <p style="margin-bottom: 30px; color: #666;">ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ãƒãƒƒãƒ—ç®¡ç†è€…å°‚ç”¨</p>
        
        <form id="loginForm" class="login-form">
            <div class="form-group">
                <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" id="email" required>
            </div>
            
            <div class="form-group">
                <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="password" required>
            </div>
            
            <button type="submit" class="btn" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> ãƒ­ã‚°ã‚¤ãƒ³
            </button>
            
            <div style="text-align: center; margin: 20px 0; color: #666;">ã¾ãŸã¯</div>
            
            <button type="button" class="btn" onclick="window.createAccount()" style="
                width: 100%;
                background: #28a745;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-top: 10px;
            ">
                <i class="fas fa-user-plus"></i> æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
            </button>
            
            <button type="button" class="btn" onclick="window.loginWithGitHub()" style="
                width: 100%;
                background: #333;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-top: 10px;
            ">
                <i class="fab fa-github"></i> GitHubã§ãƒ­ã‚°ã‚¤ãƒ³
            </button>
        </form>
        
        <div id="loginStatus" class="status"></div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ç®¡ç†ç”»é¢ -->
    <div id="mainContainer" class="container" style="display: none;">
        <div class="header">
            <h1><i class="fas fa-cogs"></i> ã‚»ã‚­ãƒ¥ã‚¢ç®¡ç†ç”»é¢</h1>
            <p>ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ãƒãƒƒãƒ— - åº—èˆ—ãƒ‡ãƒ¼ã‚¿ç®¡ç†</p>
        </div>

        <div class="user-info">
            <div class="welcome">
                <i class="fas fa-user"></i> ã‚ˆã†ã“ãã€<span id="userEmail"></span>ã•ã‚“
            </div>
            <button class="btn btn-danger" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            </button>
        </div>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="number" id="totalStores">0</div>
                <div class="label">ç·åº—èˆ—æ•°</div>
            </div>
            <div class="stat-card">
                <div class="number" id="nacoVisited">0</div>
                <div class="label">nacoè¨ªå•æ¸ˆã¿</div>
            </div>
            <div class="stat-card">
                <div class="number" id="memberVisited">0</div>
                <div class="label">ãƒ¡ãƒ³ãƒãƒ¼è¨ªå•æ¸ˆã¿</div>
            </div>
            <div class="stat-card">
                <div class="number" id="unvisited">0</div>
                <div class="label">æœªç¢ºèªåº—èˆ—</div>
            </div>
        </div>

        <!-- æ“ä½œãƒ‘ãƒãƒ« -->
        <div class="controls">
            <h2><i class="fas fa-tools"></i> ç®¡ç†æ“ä½œ</h2>
            <div class="button-grid">
                <button class="btn btn-success" onclick="showAddModal()">
                    <i class="fas fa-plus"></i> æ–°ã—ã„åº—èˆ—ã‚’è¿½åŠ 
                </button>
                <button class="btn btn-info" onclick="showCSVModal()">
                    <i class="fas fa-file-csv"></i> CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                </button>
                <button class="btn btn-warning" onclick="exportData()">
                    <i class="fas fa-download"></i> ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
                <button class="btn" onclick="reloadData()">
                    <i class="fas fa-sync-alt"></i> ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
                </button>
            </div>
        </div>

        <div id="status" class="status"></div>

        <!-- åº—èˆ—ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
        <div class="table-container">
            <h2><i class="fas fa-table"></i> åº—èˆ—ä¸€è¦§</h2>
            <table id="storesTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>åº—èˆ—å</th>
                        <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
                        <th>ä½æ‰€</th>
                        <th>GFå¯¾å¿œ</th>
                        <th>è¨ªå•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="storesTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <!-- åº—èˆ—è¿½åŠ ãƒ»ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="storeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">æ–°ã—ã„åº—èˆ—ã‚’è¿½åŠ </h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="storeForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="storeName">åº—èˆ—å <span style="color: red;">*</span></label>
                        <input type="text" id="storeName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="storeCategory">ã‚«ãƒ†ã‚´ãƒªãƒ¼ <span style="color: red;">*</span></label>
                        <select id="storeCategory" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="å’Œé£Ÿ">å’Œé£Ÿ</option>
                            <option value="æ´‹é£Ÿ">æ´‹é£Ÿ</option>
                            <option value="ã‚«ãƒ•ã‚§">ã‚«ãƒ•ã‚§</option>
                            <option value="ãƒ‘ãƒ³å±‹">ãƒ‘ãƒ³å±‹</option>
                            <option value="è²©å£²åº—">è²©å£²åº—</option>
                            <option value="ã‚¹ã‚¤ãƒ¼ãƒ„">ã‚¹ã‚¤ãƒ¼ãƒ„</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group full-width">
                    <label for="storeAddress">ä½æ‰€ <span style="color: red;">*</span></label>
                    <input type="text" id="storeAddress" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="storeLat">ç·¯åº¦</label>
                        <input type="number" id="storeLat" step="0.0001" placeholder="ä¾‹: 35.1709">
                    </div>
                    
                    <div class="form-group">
                        <label for="storeLng">çµŒåº¦</label>
                        <input type="number" id="storeLng" step="0.0001" placeholder="ä¾‹: 136.8833">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="storeHours">å–¶æ¥­æ™‚é–“</label>
                        <input type="text" id="storeHours" placeholder="ä¾‹: 10:00-19:00">
                    </div>
                    
                    <div class="form-group">
                        <label for="storeClosed">å®šä¼‘æ—¥</label>
                        <input type="text" id="storeClosed" placeholder="ä¾‹: æœˆæ›œæ—¥">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="storeTel">é›»è©±ç•ªå·</label>
                        <input type="text" id="storeTel" placeholder="ä¾‹: 052-123-4567">
                    </div>
                    
                    <div class="form-group">
                        <label for="storeGfType">GFå¯¾å¿œ</label>
                        <select id="storeGfType">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="å®Œå…¨GF">å®Œå…¨GF</option>
                            <option value="éƒ¨åˆ†GF">éƒ¨åˆ†GF</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group full-width">
                    <label for="storeDescription">åº—èˆ—èª¬æ˜</label>
                    <textarea id="storeDescription" placeholder="åº—èˆ—ã®ç‰¹å¾´ã‚„è©³ç´°æƒ…å ±ã‚’å…¥åŠ›"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="storeVisitStatus">è¨ªå•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                        <select id="storeVisitStatus">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="naco">ğŸ”´ nacoè¨ªå•æ¸ˆã¿</option>
                            <option value="member">ğŸŸ¡ ãƒ¡ãƒ³ãƒãƒ¼è¨ªå•æ¸ˆã¿</option>
                            <option value="unvisited">ğŸ¤ æœªç¢ºèªåº—èˆ—</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="storeCheckedBy">ç¢ºèªè€…</label>
                        <input type="text" id="storeCheckedBy" placeholder="ç¢ºèªã—ãŸäººã®åå‰">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="storeWebsite">ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</label>
                        <input type="url" id="storeWebsite" placeholder="https://example.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="storeInstagram">Instagram</label>
                        <input type="url" id="storeInstagram" placeholder="https://instagram.com/username">
                    </div>
                </div>
                
                <div class="form-group full-width">
                    <label for="storeImageUrl">ãƒ¡ã‚¤ãƒ³ç”»åƒURL</label>
                    <input type="url" id="storeImageUrl" placeholder="https://example.com/image.jpg">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="storeImageUrl2">è¿½åŠ ç”»åƒURL1</label>
                        <input type="url" id="storeImageUrl2" placeholder="https://example.com/image2.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="storeImageUrl3">è¿½åŠ ç”»åƒURL2</label>
                        <input type="url" id="storeImageUrl3" placeholder="https://example.com/image3.jpg">
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> ä¿å­˜
                    </button>
                    <button type="button" class="btn" onclick="closeModal()" style="flex: 1;">
                        <i class="fas fa-times"></i> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="csvModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
                <button class="close-btn" onclick="closeCSVModal()">&times;</button>
            </div>
            
            <div class="csv-drop-zone" id="csvDropZone">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</h3>
                <p>ã¾ãŸã¯ã€<strong>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</strong></p>
                <input type="file" id="csvFile" accept=".csv" style="display: none;">
            </div>
            
            <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--info-blue);">
                <h4><i class="fas fa-info-circle"></i> CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h4>
                <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ï¼š</strong></p>
                <ul style="font-size: 12px; margin: 8px 0; padding-left: 20px;">
                    <li><strong>1è¡Œç›®ï¼š</strong> åˆ—åï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰</li>
                    <li><strong>2è¡Œç›®ï¼š</strong> å…¥åŠ›ä¾‹ï¼ˆã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™ï¼‰</li>
                    <li><strong>3è¡Œç›®ä»¥é™ï¼š</strong> ãƒ‡ãƒ¼ã‚¿è¡Œ</li>
                </ul>
                <p><strong>æ¨å¥¨åˆ—åï¼š</strong></p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 5px; font-size: 12px; margin-top: 8px;">
                    <span>â€¢ åº—èˆ—å (å¿…é ˆ)</span>
                    <span>â€¢ ã‚«ãƒ†ã‚´ãƒªãƒ¼</span>
                    <span>â€¢ ä½æ‰€</span>
                    <span>â€¢ ç·¯åº¦</span>
                    <span>â€¢ çµŒåº¦</span>
                    <span>â€¢ å–¶æ¥­æ™‚é–“</span>
                    <span>â€¢ å®šä¼‘æ—¥</span>
                    <span>â€¢ é›»è©±ç•ªå·</span>
                    <span>â€¢ èª¬æ˜</span>
                    <span>â€¢ GFå¯¾å¿œ</span>
                    <span>â€¢ è¨ªå•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span>
                    <span>â€¢ ç¢ºèªè€…</span>
                </div>
                <p style="margin-top: 8px; font-size: 12px; color: #666;">
                    â€» è‹±èªåï¼ˆname, category, addressç­‰ï¼‰ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™
                </p>
            </div>

            <div id="csvPreview" style="display: none;">
                <h3>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                <div id="csvPreviewContent"></div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-success" id="csvUploadBtn" onclick="uploadCSV()" disabled>
                    <i class="fas fa-upload"></i> ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                </button>
                <button class="btn" onclick="closeCSVModal()">
                    <i class="fas fa-times"></i> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
            </div>
        </div>
    </div>

    <!-- Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let supabaseClient = null;
        
        // SupabaseåˆæœŸåŒ–
        function initSupabase() {
            const { createClient } = supabase;
            const SUPABASE_URL = 'https://lywfaolwvkewuouvkzlk.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5d2Zhb2x3dmtld3VvdXZremxrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MDg2NjcsImV4cCI6MjA2OTk4NDY2N30.wBGCHOLbP6ew7Bnvxrq0sKSm1EnHk5NNE1sWWH7ff60';
            
            supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            window.supabase = supabaseClient;
            return supabaseClient;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Supabaseã‚’åˆæœŸåŒ–
            initSupabase();
        
        let storesData = [];
        let editingStoreId = null;
        
        // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼‰
        async function createAccount() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showStatus('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹åˆ¶é™ã‚’å‰Šé™¤ï¼ˆã©ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚‚ä½œæˆå¯èƒ½ï¼‰
            
            try {
                showStatus('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆä¸­...', 'info');
                
                const { data, error } = await window.supabase.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                if (data.user) {
                    showStatus('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«èªè¨¼ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚', 'success');
                }
                
            } catch (error) {
                showStatus(`ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼‰
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status') || document.getElementById('loginStatus');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            statusDiv.style.display = 'flex';
            
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }
        
        // GitHubãƒ­ã‚°ã‚¤ãƒ³ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼‰
        async function loginWithGitHub() {
            try {
                showStatus('GitHubã§ãƒ­ã‚°ã‚¤ãƒ³ä¸­...', 'info');
                
                const { data, error } = await window.supabase.auth.signInWithOAuth({
                    provider: 'github',
                    options: {
                        redirectTo: window.location.href
                    }
                });
                
                if (error) throw error;
                
            } catch (error) {
                showStatus(`GitHubãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ç™»éŒ²
        window.createAccount = createAccount;
        window.loginWithGitHub = loginWithGitHub;
        window.showStatus = showStatus;
        
            // èªè¨¼çŠ¶æ…‹å¤‰åŒ–ã®ç›£è¦–
            supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session) {
                showStatus('ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸ', 'success');
                setTimeout(() => {
                    showMainContainer();
                    document.getElementById('userEmail').textContent = session.user.email;
                    loadStoresData();
                }, 1000);
            } else if (event === 'SIGNED_OUT') {
                showLoginContainer();
            }
        });

            // åˆæœŸåŒ–
            checkAuth();
            setupEventListeners();
            setupStoreForm();
            setupCSVUpload();
        });
        
        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            
            if (user) {
                showMainContainer();
                document.getElementById('userEmail').textContent = user.email;
                await loadStoresData();
            } else {
                showLoginContainer();
            }
        }
        

        // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
        async function login(email, password) {
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                if (data.user) {
                    showStatus('ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸ', 'success');
                    setTimeout(() => {
                        showMainContainer();
                        document.getElementById('userEmail').textContent = data.user.email;
                        loadStoresData();
                    }, 1000);
                } else {
                    throw new Error('ç®¡ç†è€…æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');
                }
                
            } catch (error) {
                showStatus(`ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
        window.logout = async function() {
            await supabase.auth.signOut();
            showLoginContainer();
        };
        
        // ç”»é¢è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function showLoginContainer() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('mainContainer').style.display = 'none';
        }
        
        function showMainContainer() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                login(email, password);
            });
            
        }
        
        // åº—èˆ—ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadStoresData() {
            try {
                showStatus('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
                
                const { data, error } = await supabase
                    .from('stores')
                    .select('*')
                    .order('id', { ascending: true });
                
                if (error) throw error;
                
                storesData = data;
                updateStoresTable();
                updateStats();
                showStatus(`${storesData.length}ä»¶ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
                
            } catch (error) {
                showStatus(`ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            const total = storesData.length;
            const naco = storesData.filter(s => s.visit_status === 'naco').length;
            const member = storesData.filter(s => s.visit_status === 'member').length;
            const unvisited = storesData.filter(s => !s.visit_status || s.visit_status === 'unvisited').length;
            
            document.getElementById('totalStores').textContent = total;
            document.getElementById('nacoVisited').textContent = naco;
            document.getElementById('memberVisited').textContent = member;
            document.getElementById('unvisited').textContent = unvisited;
        }
        
        // ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
        function updateStoresTable() {
            const tbody = document.getElementById('storesTableBody');
            tbody.innerHTML = '';
            
            storesData.forEach(store => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${store.id}</td>
                    <td>${store.name}</td>
                    <td><span class="category-badge category-${store.category}">${store.category || 'æœªåˆ†é¡'}</span></td>
                    <td>${store.address || 'ä½æ‰€æœªç™»éŒ²'}</td>
                    <td>${store.gluten_free_type || 'æœªè¨­å®š'}</td>
                    <td><span class="visit-status ${store.visit_status || 'unvisited'}">${getVisitStatusDisplay(store.visit_status)}</span></td>
                    <td>
                        <button class="btn" onclick="editStore(${store.id})" style="padding: 5px 10px; margin: 2px;">
                            <i class="fas fa-edit"></i> ç·¨é›†
                        </button>
                        <button class="btn btn-danger" onclick="deleteStore(${store.id})" style="padding: 5px 10px; margin: 2px;">
                            <i class="fas fa-trash"></i> å‰Šé™¤
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // è¨ªå•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        function getVisitStatusDisplay(status) {
            switch (status) {
                case 'naco': return 'ğŸ”´ nacoè¨ªå•æ¸ˆã¿';
                case 'member': return 'ğŸŸ¡ ãƒ¡ãƒ³ãƒãƒ¼è¨ªå•æ¸ˆã¿';
                case 'unvisited': return 'ğŸ¤ æœªç¢ºèªåº—èˆ—';
                default: return 'ğŸ¤ æœªç¢ºèªåº—èˆ—';
            }
        }
        
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        window.showAddModal = function() {
            editingStoreId = null;
            document.getElementById('modalTitle').textContent = 'æ–°ã—ã„åº—èˆ—ã‚’è¿½åŠ ';
            document.getElementById('storeForm').reset();
            document.getElementById('storeModal').style.display = 'block';
        };
        
        window.editStore = function(id) {
            const store = storesData.find(s => s.id === id);
            if (!store) return;
            
            editingStoreId = id;
            document.getElementById('modalTitle').textContent = 'åº—èˆ—æƒ…å ±ã‚’ç·¨é›†';
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
            document.getElementById('storeName').value = store.name || '';
            document.getElementById('storeCategory').value = store.category || '';
            document.getElementById('storeAddress').value = store.address || '';
            document.getElementById('storeLat').value = store.lat || '';
            document.getElementById('storeLng').value = store.lng || '';
            document.getElementById('storeHours').value = store.hours || '';
            document.getElementById('storeClosed').value = store.closed || '';
            document.getElementById('storeTel').value = store.tel || '';
            document.getElementById('storeDescription').value = store.description || '';
            document.getElementById('storeGfType').value = store.gluten_free_type || '';
            document.getElementById('storeVisitStatus').value = store.visit_status || '';
            document.getElementById('storeCheckedBy').value = store.checked_by || '';
            document.getElementById('storeWebsite').value = store.website || '';
            document.getElementById('storeInstagram').value = store.instagram || '';
            document.getElementById('storeImageUrl').value = store.image_url || '';
            document.getElementById('storeImageUrl2').value = store.image_url2 || '';
            document.getElementById('storeImageUrl3').value = store.image_url3 || '';
            
            document.getElementById('storeModal').style.display = 'block';
        };
        
        window.deleteStore = async function(id) {
            if (!confirm('ã“ã®åº—èˆ—ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            try {
                const { error } = await supabase
                    .from('stores')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                showStatus('åº—èˆ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                await loadStoresData();
                
            } catch (error) {
                showStatus(`å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        };
        
        window.closeModal = function() {
            document.getElementById('storeModal').style.display = 'none';
        };
        
        window.showCSVModal = function() {
            document.getElementById('csvModal').style.display = 'block';
        };
        
        window.closeCSVModal = function() {
            document.getElementById('csvModal').style.display = 'none';
        };
        
        window.reloadData = function() {
            loadStoresData();
        };
        
        window.exportData = function() {
            // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆå¾Œã§å®Ÿè£…ï¼‰
            showStatus('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™', 'info');
        };
        
        // CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        let csvData = null;
        
        function setupCSVUpload() {
            const dropZone = document.getElementById('csvDropZone');
            const fileInput = document.getElementById('csvFile');
            const preview = document.getElementById('csvPreview');
            const previewContent = document.getElementById('csvPreviewContent');
            const uploadBtn = document.getElementById('csvUploadBtn');

            // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆ
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.background = '#e8f5e8';
                dropZone.style.borderColor = 'var(--success-green)';
            });
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.style.background = 'var(--light-gray)';
                dropZone.style.borderColor = 'var(--primary-green)';
            });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.background = 'var(--light-gray)';
                dropZone.style.borderColor = 'var(--primary-green)';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleCSVFile(files[0]);
                }
            });

            // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¤ãƒ™ãƒ³ãƒˆ
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleCSVFile(e.target.files[0]);
                }
            });
        }

        function handleCSVFile(file) {
            if (!file.name.toLowerCase().endsWith('.csv')) {
                showStatus('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const csvText = e.target.result;
                parseCSV(csvText);
            };
            reader.readAsText(file, 'UTF-8');
        }

        function parseCSV(csvText) {
            try {
                // BOMï¼ˆByte Order Markï¼‰ã‚’é™¤å»
                csvText = csvText.replace(/^\uFEFF/, '');
                
                const lines = csvText.trim().split('\n');
                
                if (lines.length < 3) {
                    throw new Error('CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯æœ€ä½3è¡Œå¿…è¦ã§ã™ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¨ãƒ‡ãƒ¼ã‚¿è¡Œï¼‰');
                }
                
                // 1è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã—ã¦ä½¿ç”¨
                const headers = parseCSVLine(lines[0]).map(h => h.trim().replace(/"/g, ''));
                
                // 3è¡Œç›®ä»¥é™ã‚’ãƒ‡ãƒ¼ã‚¿è¡Œã¨ã—ã¦å‡¦ç†ï¼ˆ2è¡Œç›®ã¯å…¥åŠ›ä¾‹ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—ï¼‰
                csvData = [];
                for (let i = 2; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length > 0 && values.some(v => v.trim() !== '')) {
                        const row = {};
                        headers.forEach((header, index) => {
                            if (index < values.length) {
                                row[header] = values[index] ? values[index].trim().replace(/"/g, '') : '';
                            } else {
                                row[header] = '';
                            }
                        });
                        csvData.push(row);
                    }
                }

                showCSVPreview(headers, csvData.slice(0, 5));
                document.getElementById('csvUploadBtn').disabled = false;
                showStatus(`${csvData.length}è¡Œã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ2è¡Œç›®ã®å…¥åŠ›ä¾‹ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰`, 'success');
                
            } catch (error) {
                showStatus(`CSVãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('CSV Parse Error:', error);
            }
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            
            return result;
        }

        function showCSVPreview(headers, data) {
            const preview = document.getElementById('csvPreview');
            const content = document.getElementById('csvPreviewContent');
            
            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 12px;"><thead><tr>';
            headers.forEach(header => {
                html += `<th style="border: 1px solid #ddd; padding: 5px; background: #f0f0f0;">${header}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            data.forEach(row => {
                html += '<tr>';
                headers.forEach(header => {
                    html += `<td style="border: 1px solid #ddd; padding: 5px;">${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table>';
            
            content.innerHTML = html;
            preview.style.display = 'block';
        }

        async function uploadCSV() {
            if (!csvData || csvData.length === 0) {
                showStatus('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }

            try {
                showStatus('CSVãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...', 'info');
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›
                const storeData = csvData.map(row => {
                    // è¨ªå•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¤‰æ›
                    let visitStatus = 'æœªç¢ºèª';
                    const rawVisitStatus = row['è¨ªå•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹'] || row['visit_status'] || '';
                    if (rawVisitStatus === 'naco') visitStatus = 'naco';
                    else if (rawVisitStatus === 'member') visitStatus = 'member';
                    else if (rawVisitStatus === 'unvisited') visitStatus = 'æœªç¢ºèª';
                    
                    // GFå¯¾å¿œã®å¤‰æ›
                    let gfType = 'å¯¾å¿œå¯èƒ½';
                    const rawGfType = row['GFå¯¾å¿œ'] || row['gluten_free_type'] || '';
                    if (rawGfType === 'å®Œå…¨GF' || rawGfType === 'å°‚é–€åº—') gfType = 'å°‚é–€åº—';
                    else if (rawGfType === 'éƒ¨åˆ†GF' || rawGfType === 'å¯¾å¿œå¯èƒ½') gfType = 'å¯¾å¿œå¯èƒ½';
                    
                    return {
                        name: row['åº—èˆ—å'] || row['name'] || '',
                        category: row['ã‚«ãƒ†ã‚´ãƒªãƒ¼'] || row['category'] || '',
                        address: row['ä½æ‰€'] || row['address'] || '',
                        lat: parseFloat(row['ç·¯åº¦'] || row['lat'] || row['latitude']) || null,
                        lng: parseFloat(row['çµŒåº¦'] || row['lng'] || row['longitude']) || null,
                        hours: row['å–¶æ¥­æ™‚é–“'] || row['hours'] || '',
                        closed: row['å®šä¼‘æ—¥'] || row['closed'] || '',
                        tel: row['é›»è©±ç•ªå·'] || row['tel'] || row['phone'] || '',
                        description: row['åº—èˆ—èª¬æ˜'] || row['èª¬æ˜'] || row['description'] || '',
                        gluten_free_type: gfType,
                        visit_status: visitStatus,
                        checked_by: row['ç¢ºèªè€…'] || row['checked_by'] || '',
                        website: row['ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ'] || row['website'] || '',
                        instagram: row['Instagram'] || row['instagram'] || '',
                        image_url: row['ãƒ¡ã‚¤ãƒ³ç”»åƒURL'] || row['ç”»åƒURL'] || row['image_url'] || '',
                        image_url2: row['è¿½åŠ ç”»åƒURL1'] || row['image_url2'] || '',
                        image_url3: row['è¿½åŠ ç”»åƒURL2'] || row['image_url3'] || ''
                    };
                });

                // Supabaseã«ä¸€æ‹¬æŒ¿å…¥
                const { data, error } = await window.supabase
                    .from('stores')
                    .insert(storeData);

                if (error) throw error;

                showStatus(`${storeData.length}ä»¶ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`, 'success');
                closeCSVModal();
                await loadStoresData();
                
            } catch (error) {
                showStatus(`ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        window.uploadCSV = uploadCSV;

        // åº—èˆ—ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã®è¨­å®š
        function setupStoreForm() {
            if (document.getElementById('storeForm')) {
                document.getElementById('storeForm').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = {
                name: document.getElementById('storeName').value,
                category: document.getElementById('storeCategory').value,
                address: document.getElementById('storeAddress').value,
                lat: document.getElementById('storeLat').value ? parseFloat(document.getElementById('storeLat').value) : null,
                lng: document.getElementById('storeLng').value ? parseFloat(document.getElementById('storeLng').value) : null,
                hours: document.getElementById('storeHours').value,
                closed: document.getElementById('storeClosed').value,
                tel: document.getElementById('storeTel').value,
                description: document.getElementById('storeDescription').value,
                gluten_free_type: document.getElementById('storeGfType').value,
                visit_status: document.getElementById('storeVisitStatus').value,
                checked_by: document.getElementById('storeCheckedBy').value,
                website: document.getElementById('storeWebsite').value,
                instagram: document.getElementById('storeInstagram').value,
                image_url: document.getElementById('storeImageUrl').value,
                image_url2: document.getElementById('storeImageUrl2').value,
                image_url3: document.getElementById('storeImageUrl3').value
                    };
                    
                    try {
                        let result;
                        if (editingStoreId) {
                            // æ›´æ–°
                            result = await supabase
                                .from('stores')
                                .update(formData)
                                .eq('id', editingStoreId);
                        } else {
                            // æ–°è¦è¿½åŠ 
                            result = await supabase
                                .from('stores')
                                .insert(formData);
                        }
                        
                        if (result.error) throw result.error;
                        
                        showStatus(editingStoreId ? 'åº—èˆ—æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ' : 'æ–°ã—ã„åº—èˆ—ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
                        closeModal();
                        await loadStoresData();
                        
                    } catch (error) {
                        showStatus(`ä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    }
                });
            }
        }
        
    </script>
</body>
</html>