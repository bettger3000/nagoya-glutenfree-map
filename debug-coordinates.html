<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>座標データデバッグ</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .valid { background-color: #d4edda; }
        .invalid { background-color: #f8d7da; }
    </style>
</head>
<body>
    <h1>店舗座標データデバッグ</h1>
    <div id="loading">データ読み込み中...</div>
    <div id="stats" style="display:none; margin-bottom: 20px;"></div>
    <table id="coordinateTable" style="display:none;">
        <thead>
            <tr>
                <th>店名</th>
                <th>カテゴリ</th>
                <th>住所</th>
                <th>緯度（生データ）</th>
                <th>経度（生データ）</th>
                <th>緯度（型）</th>
                <th>経度（型）</th>
                <th>パース結果</th>
                <th>有効性</th>
            </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
    </table>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script>
        const SUPABASE_URL = 'https://lywfaolwvkewuouvkzlk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5d2Zhb2x3dmtld3VvdXZremxrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MDg2NjcsImV4cCI6MjA2OTk4NDY2N30.wBGCHOLbP6ew7Bnvxrq0sKSm1EnHk5NNE1sWWH7ff60';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function debugCoordinates() {
            try {
                const { data: stores, error } = await supabase
                    .from('stores')
                    .select('*')
                    .order('name');

                if (error) throw error;

                const tbody = document.getElementById('tableBody');
                let validCount = 0;
                let invalidCount = 0;

                stores.forEach(store => {
                    const row = document.createElement('tr');
                    
                    const latValue = store.latitude;
                    const lngValue = store.longitude;
                    const parsedLat = parseFloat(latValue);
                    const parsedLng = parseFloat(lngValue);
                    
                    const latValid = !isNaN(parsedLat) && parsedLat >= 20 && parsedLat <= 46;
                    const lngValid = !isNaN(parsedLng) && parsedLng >= 122 && parsedLng <= 154;
                    const bothValid = latValid && lngValid;
                    
                    if (bothValid) validCount++;
                    else invalidCount++;
                    
                    row.className = bothValid ? 'valid' : 'invalid';
                    
                    row.innerHTML = `
                        <td>${store.name || 'N/A'}</td>
                        <td>${store.category || 'N/A'}</td>
                        <td>${store.address || 'N/A'}</td>
                        <td>${JSON.stringify(latValue)}</td>
                        <td>${JSON.stringify(lngValue)}</td>
                        <td>${typeof latValue}</td>
                        <td>${typeof lngValue}</td>
                        <td>緯度: ${parsedLat}, 経度: ${parsedLng}</td>
                        <td>${bothValid ? '✅ 有効' : '❌ 無効'} (緯度: ${latValid ? '✅' : '❌'}, 経度: ${lngValid ? '✅' : '❌'})</td>
                    `;
                    
                    tbody.appendChild(row);
                });

                document.getElementById('stats').innerHTML = `
                    <p><strong>統計:</strong> 
                    全店舗数: ${stores.length}, 
                    有効な座標: ${validCount}, 
                    無効な座標: ${invalidCount}
                    </p>
                `;

                document.getElementById('loading').style.display = 'none';
                document.getElementById('stats').style.display = 'block';
                document.getElementById('coordinateTable').style.display = 'table';

            } catch (error) {
                console.error('エラー:', error);
                document.getElementById('loading').textContent = 'エラー: ' + error.message;
            }
        }

        debugCoordinates();
    </script>
</body>
</html>